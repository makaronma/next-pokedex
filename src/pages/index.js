import Head from "next/head";
import Image from "next/image";
import Link from "next/link";

import Card from "@mui/material/Card";
import CardContent from "@mui/material/CardContent";
import CardMedia from "@mui/material/CardMedia";
import Typography from "@mui/material/Typography";
import { CardActionArea, CardActions } from "@mui/material";

export default function Home({ pokes }) {
  return (
    <div>
      <Head>
        <title>PokeDex</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>Search Bar</div>
      <h2>Poke List: </h2>
      <Card sx={{ maxWidth: 345 }}>
        <Link href={"/login"} passHref>
          <CardActionArea>
            <CardMedia
              component="img"
              height="140"
              image="/static/images/cards/contemplative-reptile.jpg"
              alt="green iguana"
            />
            <CardContent>
              <Typography gutterBottom variant="h5" component="div">
                Lizard
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Lizards are a widespread group of squamate reptiles, with over
                6,000 species, ranging across all continents except Antarctica
              </Typography>
            </CardContent>
          </CardActionArea>
        </Link>
        <Link href={"/profile"} passHref>
          <CardActions>Share</CardActions>
        </Link>
      </Card>
      <div>
        {pokes.map((poke) => (
          <Link
            key={`pokeListItem-${poke.id}`}
            href={`/pokes/${poke.id}`}
            passHref
          >
            <div>
              <p>id: {poke.id}</p>
              <p>name: {poke.name}</p>
              <Image
                loader={() => poke.image}
                src={`${poke.name}-front-default.png`}
                alt={poke.name}
                width={100}
                height={100}
              />
              {/* <p>types: {poke.types}</p> */}
            </div>
          </Link>
        ))}
      </div>
    </div>
  );
}

export async function getStaticProps() {
  const res = await fetch(
    `https://pokeapi.co/api/v2/pokemon?offset=0&limit=${process.env.POKEAMOUNT}`
  );
  const { results } = await res.json();
  const urls = results.map((r) => r.url);

  const pokes = await Promise.all(
    urls.map(async (url) => {
      const res = await fetch(url);
      return res.json();
    })
  );
  const pokesModified = pokes.map(({ id, name, sprites, types }) => ({
    id,
    name,
    image: sprites.front_default,
    types,
  }));

  return {
    props: {
      pokes: pokesModified,
    },
  };
}
