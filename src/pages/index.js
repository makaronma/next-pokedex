import Head from "next/head";
import PokeItem from "common/components/PokeDisplay/Item";

export default function Home({ pokes }) {
  return (
    <div>
      <Head>
        <title>PokeDex</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>Search Bar</div>
      <h2>Poke List: </h2>

      <div
        style={{ display: "flex", flexWrap: "wrap", justifyContent: "center" }}
      >
        {pokes.map((poke) => (
          <PokeItem
            key={`pokeListItem-${poke.id}`}
            id={poke.id}
            name={poke.name}
            img={poke.image}
          />
        ))}
      </div>
    </div>
  );
}

export async function getStaticProps() {
  const res = await fetch(
    `https://pokeapi.co/api/v2/pokemon?offset=0&limit=${process.env.POKEAMOUNT}`
  );
  const { results } = await res.json();
  const urls = results.map((r) => r.url);

  const pokes = await Promise.all(
    urls.map(async (url) => {
      const res = await fetch(url);
      return res.json();
    })
  );
  const pokesModified = pokes.map(({ id, name, sprites, types }) => ({
    id,
    name,
    image: sprites.front_default,
    types,
  }));

  return {
    props: {
      pokes: pokesModified,
    },
  };
}
